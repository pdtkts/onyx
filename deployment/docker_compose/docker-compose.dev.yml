# Docker Compose Override for Development/Testing
# This file exposes service ports for development and testing purposes
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d --wait
#
# Or set COMPOSE_FILE environment variable:
#   export COMPOSE_FILE=docker-compose.yml:docker-compose.dev.yml
#   docker compose up -d --wait

services:
  api_server:
    ports:
      - "8080:8080"

  # Uncomment the block below to enable the MCP server for Onyx.
  # mcp_server:
  #   ports:
  #     - "8090:8090"

  relational_db:
    ports:
      - "5432:5432"

  index:
    ports:
      - "19071:19071"
      - "8081:8081"
    healthcheck:
      # We use 19071 because the application server at 8010 is not ready until
      # it is activated/configured by the application.
      test: ["CMD-SHELL", "curl -sf http://localhost:19071/state/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  opensearch:
    ports:
      - "9200:9200"

  inference_model_server:
    ports:
      - "9000:9000"

  cache:
    ports:
      - "6379:6379"

  minio:
    # use different ports to avoid conflicts with model servers
    ports:
      - "9004:9000"
      - "9005:9001"

  code-interpreter:
    ports:
      - "8000:8000"
